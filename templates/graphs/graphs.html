{% extends 'base.html' %}
{% block content %}
    {% load staticfiles %}

    <link href={% static "graphs/css/pager.css" %} rel="stylesheet">
    <link href={% static "graphs/css/graphs.css" %} rel="stylesheet">

    <div class="container graphs padding-bottom-6">

        <ul class="nav nav-pills margin-bottom-4">
            {% if uid %}
                <li class="active text-center">
                    <a href="#owned_graphs" data-toggle="tab">My Graphs <br><span id="ownedGraphsTotal">{{ owned_graphs.total }}</span></a>
                </li>
                <li class="text-center">
                    <a href="#shared_graphs" data-toggle="tab">Shared Graphs <br><span id="sharedGraphsTotal">{{ shared_graphs.total }}</span></a>
                </li>
            {% endif %}

            <li class="text-center {% if not uid %} active {% endif %}">
                <a href="#public_graphs" data-toggle="tab">Public Graphs <br><span id="publicGraphsTotal">{{ public_graphs.total }}</span></a>
            </li>

            <li class="text-center">
                <a href="{% url 'upload_graph' %}">Upload New <br>Graph</a>
            </li>
        </ul>

        <div id="toolbar">
            <div class="form-inline" role="form">
                <div class="form-group">
                    <span>Search: </span>
                    <input name="search" style="width: 300px" class="form-control graphs-table-search" type="text"
                           placeholder="Search Graphs, Nodes and Edges">
                </div>
                &nbsp;
                <div class="form-group">
                    <span>Tags: </span>
                    <input id="tagSearchBar" name="tags" class="form-control graphs-table-search" type="text"
                           placeholder="Search Tags">
                </div>
                <button id="ok" type="submit" class="btn btn-default">Search</button>
                <a id="clear" class="btn btn-default">Clear Search</a>
            </div>
        </div>

        <div id="myTabContent" class="tab-content">

            {% if uid %}
                <div class="tab-pane fade in active" id="owned_graphs">
                    <table id="OwnedGraphsTable"
                           data-toggle="table"
                           data-show-refresh="true"
                           data-show-columns="true"
                           data-show-toggle="true"
                           data-query-params="graphsPage.graphsTable.queryParams"
                           data-ajax="graphsPage.ownedGraphsTable.getGraphsByOwner"
                           data-side-pagination="server"
                           data-data-field="graphs"
                           data-pagination="true"
                           data-sort-name="updated_at"
                           data-id-field="id"
                           data-sort-order="asc">
                        <thead>
                        <tr>
                            <th data-field="name" data-sortable="True" data-formatter="graphsPage.graphsTable.graphNameFormatter">Graph Name</th>
                            <th data-field="tags" data-formatter="graphsPage.graphsTable.tagsFormatter">Tags</th>
                            <th data-field="owner_email" data-formatter="graphsPage.graphsTable.ownerEmailFormatter">Graph Owner</th>
                            <th data-field="updated_at" data-formatter="utils.dateFormatter" data-sortable="True">Last Modified</th>
                            <th data-field="is_public" data-sortable="True"
                                data-formatter="graphsPage.graphsTable.visibilityFormatter">Visibility
                            </th>
                            <th data-field="operations" data-formatter="graphsPage.graphsTable.operationsFormatter"
                                data-events="graphsPage.graphsTable.operationEvents">
                                Operations
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>

                <div class="tab-pane fade" id="shared_graphs">
                    <table id="SharedGraphsTable"
                           data-toggle="table"
                           data-show-refresh="true"
                           data-show-columns="true"
                           data-show-toggle="true"
                           data-query-params="graphsPage.graphsTable.queryParams"
                           data-ajax="graphsPage.sharedGraphsTable.getGraphsByGroupMember"
                           data-side-pagination="server"
                           data-data-field="graphs"
                           data-pagination="true"
                           data-sort-name="updated_at"
                           data-id-field="id"
                           data-sort-order="asc">
                        <thead>
                        <tr>
                            <th data-field="name" data-sortable="True" data-formatter="graphsPage.graphsTable.graphNameFormatter">Graph Name</th>
                            <th data-field="tags" data-formatter="graphsPage.graphsTable.tagsFormatter">Tags</th>
                            <th data-field="owner_email" data-formatter="graphsPage.graphsTable.ownerEmailFormatter">Graph Owner</th>
                            <th data-field="updated_at" data-formatter="utils.dateFormatter" data-sortable="True">Last Modified</th>
                            <th data-field="is_public" data-sortable="True"
                                data-formatter="graphsPage.graphsTable.visibilityFormatter">Visibility
                            </th>
                            <th data-field="operations" data-formatter="graphsPage.graphsTable.operationsFormatter"
                                data-events="graphsPage.graphsTable.operationEvents">
                                Operations
                            </th>
                        </tr>
                        </thead>
                    </table>
                </div>
            {% endif %}

            <div class="tab-pane fade {% if not uid %} in active {% endif %}" id="public_graphs">
                <table id="PublicGraphsTable"
                       data-toggle="table"
                       data-show-refresh="true"
                       data-show-columns="true"
                       data-show-toggle="true"
                       data-query-params="graphsPage.graphsTable.queryParams"
                       data-ajax="graphsPage.publicGraphsTable.getPublicGraphs"
                       data-side-pagination="server"
                       data-data-field="graphs"
                       data-pagination="true"
                       data-sort-name="updated_at"
                       data-id-field="id"
                       data-sort-order="asc">
                    <thead>
                    <tr>
                        <th data-field="name" data-sortable="True" data-formatter="graphsPage.graphsTable.graphNameFormatter">Graph Name</th>
                        <th data-field="tags" data-formatter="graphsPage.graphsTable.tagsFormatter">Tags</th>
                        <th data-field="owner_email" data-formatter="graphsPage.graphsTable.ownerEmailFormatter">Graph Owner</th>
                        <th data-field="updated_at" data-formatter="utils.dateFormatter" data-sortable="True">Last Modified</th>
                        <th data-field="operations" data-formatter="graphsPage.graphsTable.operationsFormatter"
                            data-events="graphsPage.graphsTable.operationEvents">
                            Operations
                        </th>
                    </tr>
                    </thead>
                </table>
            </div>

            <div class="tab-pane fade" id="upload_graph">
                uoad
            </div>

        </div>

        <div class="modal fade" id="deleteGraphModal" tabindex="-1" role="dialog" aria-labelledby="deleteGraphModal"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="deleteModal">Confirm Delete</h4>
                    </div>
                    <div class="modal-body">

                        <h4>Are you sure you want to delete this graph?</h4>
                        <br/>
                        <button type="button" id="ConfirmRemoveGraphBtn" class="btn btn-success">
                            Delete Graph
                        </button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer class="footer">
        <br>Powered by <a href="https://www.djangoproject.com/">Django 1.7.6</a>
        <br><a href="http://js.cytoscape.org/">Cytoscape.js 2.5.0</a>
    </footer>

    <!-- JSON support for Graphs Page -->
    <script type="text/javascript" src="{% static 'js/utils.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/graphs_page.js' %}"></script>

    <script>
        $(document).ready(function () {
            graphsPage.init();
        });
    </script>
{% endblock %}